<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="icon" type="image/png" href="favicon/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/svg+xml" href="favicon/favicon.svg" />
    <link rel="shortcut icon" href="favicon/favicon.ico" />
    <link rel="apple-touch-icon" sizes="180x180" href="favicon/apple-touch-icon.png" />
    <meta name="apple-mobile-web-app-title" content="AKI'S CHANCE" />
    <link rel="manifest" href="favicon/site.webmanifest" />
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AKI'S CHANCE SLOT MACHINE</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Tone.js CDN for sound effects -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.min.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(to bottom right, #8B0000, #000000); /* Slot machine theme background */
            min-height: 100vh; /* Ensure full height */
            color: white;
            overflow-x: hidden; /* Prevent horizontal scrollbars from header/footer */
            display: flex; /* Use flexbox for overall page layout */
            flex-direction: column; /* Stack header, main, footer vertically */
        }
        /* Apply uppercase selectively */
        .slot-container,
        .slot-title,
        .text-xl, /* For balance */
        .text-lg, /* For bet */
        .game-button,
        .message-box,
        .modal-content h2,
        .modal-content p,
        .footer p {
            text-transform: uppercase;
        }

        .slot-container {
            background-color: rgba(0, 0, 0, 0.7);
            border: 8px solid #FFD700; /* Gold border */
            border-radius: 20px;
            padding: 2rem;
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.8), 0 0 15px rgba(255, 215, 0, 0.5); /* Gold glow */
            max-width: 95%; /* Increased max-width */
            width: 700px; /* Increased width */
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1.5rem;
            position: relative;
            z-index: 1;
            margin: auto; /* Center it within its flex parent (main) */
        }
        .slot-title {
            font-size: 2.5rem;
            font-weight: 700;
            color: #FFD700; /* Gold color */
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7);
            margin-bottom: 1rem;
        }
        .reel-container {
            display: flex;
            gap: 1rem; /* Adjusted gap for wider layout */
        }
        .reel {
            background-color: #1a1a1a; /* Dark background for reels */
            border: 2px solid #555;
            border-radius: 10px;
            width: 150px; /* Increased reel width */
            height: 150px; /* Increased reel height */
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 3.5rem; /* Large symbol size */
            overflow: hidden;
            position: relative;
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.8);
            transition: transform 0.1s ease-out; /* For slight bounce */
        }
        .reel-symbol {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            transition: transform 0.2s ease-out; /* For symbol snap */
        }
        .reel-image { /* Style for the actual image inside the reel */
            width: 80%; /* Adjust as needed */
            height: 80%; /* Adjust as needed */
            object-fit: contain; /* Ensures image fits without distortion */
            transition: transform 0.2s ease-out;
        }
        .spinning .reel-image {
            animation: spin-image-animation 0.1s linear infinite; /* Faster spin during animation */
        }

        @keyframes spin-image-animation {
            0% { transform: rotateY(0deg); }
            100% { transform: rotateY(360deg); }
        }

        .reel.spinning {
            animation: reel-spin-effect 0.1s linear infinite; /* Visual effect for the reel itself */
        }

        @keyframes reel-spin-effect {
            0% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
            100% { transform: translateY(0); }
        }

        .button-group {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            justify-content: center;
        }
        .game-button {
            background: linear-gradient(to right, #FFD700, #FFA500); /* Gold to Orange gradient */
            color: #8B0000; /* Dark Red text */
            padding: 0.75rem 1.5rem;
            border-radius: 9999px; /* Fully rounded */
            font-weight: 700;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.4);
            transition: all 0.2s ease-in-out;
            border: none;
            cursor: pointer;
            outline: none;
        }
        .game-button:hover {
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.6);
            background: linear-gradient(to right, #FFE033, #FFC107); /* Lighter hover gradient */
        }
        .game-button:active {
            transform: translateY(0);
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.3);
        }
        .game-button:disabled {
            background: #555;
            color: #aaa;
            cursor: not-allowed;
            box-shadow: none;
            transform: none;
        }
        .message-box {
            background-color: rgba(0, 0, 0, 0.8);
            border: 2px solid #FFD700;
            border-radius: 10px;
            padding: 1rem;
            text-align: center;
            font-size: 1.2rem;
            min-height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            box-sizing: border-box;
            word-wrap: break-word;
        }

        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out;
        }
        .modal-overlay.show {
            opacity: 1;
            visibility: visible;
        }
        .modal-content {
            background-color: #1a1a1a;
            border: 5px solid #FFD700;
            border-radius: 15px;
            padding: 2rem;
            text-align: center;
            box-shadow: 0 0 25px rgba(255, 215, 0, 0.7);
            max-width: 400px;
            width: 90%;
            position: relative;
        }
        .modal-close-button {
            position: absolute;
            top: 10px;
            right: 15px;
            background: none;
            border: none;
            font-size: 1.8rem;
            color: #FFD700;
            cursor: pointer;
        }

        /* Confetti effect (simple) */
        .confetti-piece {
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: #FFD700; /* Gold */
            opacity: 0;
            animation: confetti-fall 2s forwards;
            pointer-events: none;
        }

        @keyframes confetti-fall {
            0% {
                transform: translateY(0) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(500px) rotate(720deg);
                opacity: 0;
            }
        }

        /* Header/Footer Specific Styles from provided HTML */
        .footer {
            background-color: #492833; /* Specific footer background */
            color: white;
            text-align: center;
            padding: 2rem 1rem;
        }
        #mobile-menu {
            max-height: 0;
            opacity: 0;
            overflow: hidden;
            transition: max-height 0.5s ease-in-out, opacity 0.5s ease-in-out;
            position: absolute;
            width: 100%;
            left: 0;
            top: 100%;
            background-color: #492833;
        }
        #mobile-menu.menu-open {
            max-height: 25rem;
            opacity: 1;
        }
        #desktop-menu-items {
            position: relative;
        }
        #sliding-highlighter {
            position: absolute;
            top: 0;
            left: 0;
            width: 0;
            height: 100%;
            background-color: #492833;
            border-radius: 0.375rem;
            transition: left 0.3s ease-in-out, width 0.3s ease-in-out;
            z-index: -1;
        }
        .hamburger-icon span {
            display: block;
            width: 24px;
            height: 2px;
            background-color: white;
            transition: all 0.3s cubic-bezier(.08,.82,.17,1);
        }
        /* Updated hamburger to 'X' animation */
        #mobile-menu-button.open .hamburger-icon span:nth-child(1) {
            transform: translateY(10px) rotate(45deg);
        }
        #mobile-menu-button.open .hamburger-icon span:nth-child(2) {
            opacity: 0;
        }
        #mobile-menu-button.open .hamburger-icon span:nth-child(3) {
            transform: translateY(-10px) rotate(-45deg);
        }
        /* Mobile menu link hover effect */
        .mobile-menu-link {
            background-color: #492833;
            transition: background-color 0.2s ease-in-out;
        }
        .mobile-menu-link:hover {
            background-color: #000000;
        }
        /* Responsive adjustments */
        @media (max-width: 768px) { /* Adjusted breakpoint for wider layout */
            .slot-title {
                font-size: 2rem;
            }
            .reel {
                width: 100px; /* Smaller reels on smaller screens */
                height: 120px;
                font-size: 3rem;
            }
            .reel-container {
                gap: 0.5rem;
            }
            .game-button {
                padding: 0.6rem 1.2rem;
                font-size: 0.9rem;
            }
            .slot-container {
                padding: 1.5rem;
                gap: 1rem;
            }
            .message-box {
                font-size: 1rem;
            }
        }
    </style>
</head>
<body class="font-medium">

    <!-- Header section with navigation -->
<header class="bg-black/70 backdrop-blur-sm sticky top-0 z-50 shadow-lg">
        <nav class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-20">
                <div class="flex-shrink-0">
                    <a href="/index.html">
                        <img src="/images/10c.png" class="h-10" alt="10 Controls Logo" onerror="this.onerror=null;this.src='https://placehold.co/160x40/492833/FFFFFF?text=LOGO+NOT+FOUND';">
                    </a>
                </div>

                <!-- Desktop navigation items -->
                <div id="desktop-menu-items" class="hidden md:flex items-center space-x-4">
                    <div id="sliding-highlighter"></div>
                    <a href="/index.html" class="text-gray-300 hover:text-white px-3 py-2 rounded-md text-sm font-medium relative z-10" style="text-transform: none;">Latest</a>
                    <a href="/schedule.html" class="text-gray-300 hover:text-white px-3 py-2 rounded-md text-sm font-medium relative z-10" style="text-transform: none;">Schedule</a>
                    <a href="/standings.html" class="text-gray-300 hover:text-white px-3 py-2 rounded-md text-sm font-medium relative z-10" style="text-transform: none;">Standings</a>
                    <a href="/teams.html" class="text-gray-300 hover:text-white px-3 py-2 rounded-md text-sm font-medium relative z-10" style="text-transform: none;">Teams</a>
                </div>

                <!-- Mobile menu button (hamburger icon) -->
                <div class="-mr-2 flex md:hidden">
                    <button type="button" id="mobile-menu-button" class="inline-flex items-center justify-center p-2 rounded-md text-white focus:outline-none" style="background-color: #492833;">
                        <span class="sr-only">Open main menu</span>
                        <div class="hamburger-icon space-y-2">
                            <span></span>
                            <span></span>
                            <span></span>
                        </div>
                    </button>
                </div>
            </div>
        </nav>
        <!-- Mobile menu content, toggled by JS -->
        <div class="md:hidden" id="mobile-menu">
            <div class="px-2 pt-2 pb-3 space-y-1">
                <a href="/index.html" class="text-white block px-3 py-2 rounded-md text-base font-medium mobile-menu-link" style="text-transform: none;">Latest</a>
                <a href="/schedule.html" class="text-white block px-3 py-2 rounded-md text-base font-medium mobile-menu-link" style="text-transform: none;">Schedule</a>
                <a href="/standings.html" class="text-white block px-3 py-2 rounded-md text-base font-medium mobile-menu-link" style="text-transform: none;">Standings</a>
                <a href="/teams.html" class="text-white block px-3 py-2 rounded-md text-base font-medium mobile-menu-link" style="text-transform: none;">Teams</a>
            </div>
        </div>
    </header>

    <!-- Main Content Area - Slot Machine -->
    <main class="flex-grow relative max-w-7xl mx-auto p-4 sm:p-6 lg:p-8 flex justify-center items-center">
        <div class="slot-container">
            <h1 class="slot-title">AKI'S CHANCE</h1>

            <div class="text-xl font-bold text-yellow-400">
                BALANCE: $<span id="balance">100</span>
            </div>
            <div class="text-lg font-semibold text-yellow-300">
                BET: $<span id="bet">1</span>
            </div>

            <div class="reel-container">
                <div class="reel" id="reel1"><img src="https://web-assests.monsterenergy.com/mnst/5587a01b-3c83-42f7-a741-b29a1d534409.png" class="reel-image"></div>
                <div class="reel" id="reel2"><img src="https://orlandocigarstogo.com/cdn/shop/files/68786b85-7b8f-47f2-96dc-4bac3ce9330e.webp?v=1704161104" class="reel-image"></div>
                <div class="reel" id="reel3"><img src="https://png.pngtree.com/png-vector/20220710/ourmid/pngtree-vape-icon-illustration-png-png-image_5837016.png" class="reel-image"></div>
            </div>

            <div class="button-group">
                <button class="game-button" id="spinButton">SPIN</button>
                <button class="game-button" id="bet1Button">BET $1</button>
                <button class="game-button" id="bet5Button">BET $5</button>
                <button class="game-button" id="bet10Button">BET $10</button>
                <button class="game-button" id="maxBetButton">MAX BET</button>
                <button class="game-button" id="cashOutButton">CASH OUT</button>
                <button class="game-button" id="musicToggleButton">MUSIC: OFF</button>
                <button class="game-button" id="sfxToggleButton">SFX: OFF</button>
            </div>

            <div class="message-box" id="messageBox">WELCOME TO AKI'S CHANCE! SPIN TO WIN!</div>
        </div>
    </main>

    <!-- Message Modal -->
    <div class="modal-overlay" id="messageModalOverlay">
        <div class="modal-content">
            <button class="modal-close-button" id="modalCloseButton">&times;</button>
            <h2 class="text-2xl font-bold text-yellow-400 mb-4" id="modalTitle"></h2>
            <p class="text-white text-lg" id="modalMessage"></p>
            <button class="game-button mt-6" id="modalOkButton">OK</button>
        </div>
    </div>

    <!-- YouTube Player Container (hidden) -->
    <div id="youtubePlayer" style="width: 1px; height: 1px; overflow: hidden; position: absolute; top: -100px; left: -100px;"></div>

    <!-- YouTube IFrame Player API script -->
    <script>
        var player;
        function onYouTubeIframeAPIReady() {
            player = new YT.Player('youtubePlayer', {
                height: '1', // Make it very small
                width: '1',  // Make it very small
                videoId: '69Km895ntNc', // Your YouTube video ID
                playerVars: {
                    'autoplay': 0, // Autoplay is handled by button click
                    'controls': 0, // No controls visible
                    'loop': 1,     // Loop the video
                    'playlist': '69Km895ntNc', // Required for looping a single video
                    'disablekb': 1, // Disable keyboard controls
                    'fs': 0,        // Disable fullscreen button
                    'modestbranding': 1, // Remove YouTube logo
                    'rel': 0,       // Do not show related videos
                    'showinfo': 0,  // Hide video title and uploader info
                    'iv_load_policy': 3 // Hide video annotations
                },
                events: {
                    'onReady': onPlayerReady,
                    'onStateChange': onPlayerStateChange
                }
            });
        }

        function onPlayerReady(event) {
            // Set volume to 30% when player is ready
            player.setVolume(30);
            console.log('YOUTUBE PLAYER READY');
        }

        function onPlayerStateChange(event) {
            const musicToggleButton = document.getElementById('musicToggleButton');
            console.log('PLAYER STATE CHANGE:', event.data); // Log state changes for debugging

            if (event.data === YT.PlayerState.PLAYING) {
                isMusicPlaying = true;
                musicToggleButton.textContent = "MUSIC: ON";
            } else if (event.data === YT.PlayerState.PAUSED || event.data === YT.PlayerState.ENDED || event.data === YT.PlayerState.BUFFERING) {
                isMusicPlaying = false;
                musicToggleButton.textContent = "MUSIC: OFF";
            }
        }

        // Load the IFrame Player API code asynchronously.
        var tag = document.createElement('script');
        tag.src = "https://www.youtube.com/iframe_api";
        var firstScriptTag = document.getElementsByTagName('script')[0];
        firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
    </script>

    <script>
        // --- Self-invoking function to encapsulate all the logic ---
        (function() {
            // --- Wait for the DOM to be fully loaded before running scripts ---
            document.addEventListener('DOMContentLoaded', function() {
                // --- Mobile menu toggle script ---
                const mobileMenuButton = document.getElementById('mobile-menu-button');
                const mobileMenu = document.getElementById('mobile-menu');

                if (mobileMenuButton && mobileMenu) {
                    mobileMenuButton.addEventListener('click', () => {
                        mobileMenu.classList.toggle('menu-open');
                        mobileMenuButton.classList.toggle('open');
                    });
                }
                
                // --- Sliding highlighter script for desktop navigation ---
                const menuItemsContainer = document.getElementById('desktop-menu-items');
                if (menuItemsContainer) {
                    const menuLinks = menuItemsContainer.querySelectorAll('a');
                    const highlighter = document.getElementById('sliding-highlighter');
                    const activeLink = menuItemsContainer.querySelector('a[aria-current="page"]');

                    function setHighlighterToLink(link) {
                        if (!link) {
                            if(highlighter) highlighter.style.width = '0px';
                            return;
                        }
                        if(highlighter) {
                            highlighter.style.left = `${link.offsetLeft}px`;
                            highlighter.style.width = `${link.offsetWidth}px`;
                        }
                    }
                    
                    setHighlighterToLink(activeLink);

                    menuLinks.forEach(link => {
                        link.addEventListener('mouseenter', () => setHighlighterToLink(link));
                    });
                    
                    menuItemsContainer.addEventListener('mouseleave', () => {
                        setHighlighterToLink(activeLink);
                    });
                }

                // Game state variables
                let balance = 100;
                let bet = 1;
                let isSpinning = false;
                let isMusicPlaying = false; // Track music state
                let isSfxEnabled = false;   // Track SFX state

                // DOM elements
                const balanceDisplay = document.getElementById('balance');
                const betDisplay = document.getElementById('bet');
                const reelElements = [
                    document.getElementById('reel1'),
                    document.getElementById('reel2'),
                    document.getElementById('reel3')
                ];
                const spinButton = document.getElementById('spinButton');
                const bet1Button = document.getElementById('bet1Button'); // New bet button
                const bet5Button = document.getElementById('bet5Button'); // New bet button
                const bet10Button = document.getElementById('bet10Button'); // New bet button
                const maxBetButton = document.getElementById('maxBetButton');
                const cashOutButton = document.getElementById('cashOutButton');
                const messageBox = document.getElementById('messageBox');
                const musicToggleButton = document.getElementById('musicToggleButton'); // Music toggle button
                const sfxToggleButton = document.getElementById('sfxToggleButton');     // SFX toggle button

                // Modal elements
                const messageModalOverlay = document.getElementById('messageModalOverlay');
                const modalTitle = document.getElementById('modalTitle');
                const modalMessage = document.getElementById('modalMessage');
                const modalCloseButton = document.getElementById('modalCloseButton');
                const modalOkButton = document.getElementById('modalOkButton');

                // Initialize Tone.js for sound effects
                let spinSynth, winSynth, loseSynth, reelSpinningNoise;

                async function initAudioContext() {
                    // Tone.start() is necessary to start the audio context on user interaction
                    if (Tone.context.state !== 'running') {
                        await Tone.start();
                        console.log('AUDIOCONTEXT STARTED');
                    }

                    // Spin sound (lever pull)
                    spinSynth = new Tone.MembraneSynth({
                        pitchDecay: 0.05,
                        octaves: 2,
                        envelope: {
                            attack: 0.001,
                            decay: 0.4,
                            sustain: 0.01,
                            release: 0.1,
                            attackCurve: "exponential"
                        }
                    }).toDestination();

                    // Win sound: a cheerful ascending arpeggio
                    winSynth = new Tone.Synth().toDestination();
                    winSynth.envelope.release = 0.5; // Make the win sound slightly longer

                    // Lose sound: a short, descending, slightly dissonant tone
                    loseSynth = new Tone.Synth().toDestination();
                    loseSynth.envelope.release = 0.3; // Make the lose sound slightly longer

                // Call initAudioContext on first user interaction (e.g., spin button click)
                document.addEventListener('click', initAudioContext, { once: true });


                // Slot machine symbols with names and image URLs
                // Increased frequency of 'cherry', 'lemon', 'orange', and 'grape' to boost winning odds.
                const symbolData = [
                    { name: 'cherry', imageUrl: 'https://web-assests.monsterenergy.com/mnst/5587a01b-3c83-42f7-a741-b29a1d534409.png' },
                    { name: 'cherry', imageUrl: 'https://web-assests.monsterenergy.com/mnst/5587a01b-3c83-42f7-a741-b29a1d534409.png' },
                    { name: 'cherry', imageUrl: 'https://web-assests.monsterenergy.com/mnst/5587a01b-3c83-42f7-a741-b29a1d534409.png' },
                    { name: 'cherry', imageUrl: 'https://web-assests.monsterenergy.com/mnst/5587a01b-3c83-42f7-a741-b29a1d534409.png' }, // More cherries
                    { name: 'lemon', imageUrl: 'https://orlandocigarstogo.com/cdn/shop/files/68786b85-7b8f-47f2-96dc-4bac3ce9330e.webp?v=1704161104' },
                    { name: 'lemon', imageUrl: 'https://orlandocigarstogo.com/cdn/shop/files/68786b85-7b8f-47f2-96dc-4bac3ce9330e.webp?v=1704161104' },
                    { name: 'lemon', imageUrl: 'https://orlandocigarstogo.com/cdn/shop/files/68786b85-7b8f-47f2-96dc-4bac3ce9330e.webp?v=1704161104' }, // More lemons
                    { name: 'orange', imageUrl: 'https://png.pngtree.com/png-vector/20220710/ourmid/pngtree-vape-icon-illustration-png-png-image_5837016.png' },
                    { name: 'orange', imageUrl: 'https://png.pngtree.com/png-vector/20220710/ourmid/pngtree-vape-icon-illustration-png-png-image_5837016.png' },
                    { name: 'orange', imageUrl: 'https://png.pngtree.com/png-vector/20220710/ourmid/pngtree-vape-icon-illustration-png-png-image_5837016.png' }, // More oranges
                    { name: 'grape', imageUrl: 'https://sml-uncorked.com/cdn/shop/products/372231cb145ac6d176945a88054fd962_1250x.png?v=1745851627' },
                    { name: 'grape', imageUrl: 'https://sml-uncorked.com/cdn/shop/products/372231cb145ac6d176945a88054fd962_1250x.png?v=1745851627' },
                    { name: 'grape', imageUrl: 'https://sml-uncorked.com/cdn/shop/products/372231cb145ac6d176945a88054fd962_1250x.png?v=1745851627' }, // More grapes
                    { name: 'bell', imageUrl: 'https://cdn.discordapp.com/attachments/1323758532432236638/1394942070753460325/23.png?ex=6878a48a&is=6877530a&hm=505197be035e2a4d947c754b085952424c29b421575a37e60301beda1550fa04&' },
                    { name: 'diamond', imageUrl: 'https://a.espncdn.com/combiner/i?img=/i/headshots/rpm/players/full/836.png' },
                    { name: 'clover', imageUrl: 'https://images-wixmp-ed30a86b8c4ca887773594c2.wixmp.com/f/b538e535-b519-48e1-85c7-26a5896a7e0a/despnni-074431d6-88aa-45ef-a9ee-4fb95249dc9e.png?token=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJ1cm46YXBwOjdlMGQxODg5ODIyNjQzNzNhNWYwZDQxNWVhMGQyNmUwIiwiaXNzIjoidXJuOmFwcDo3ZTBkMTg4OTgyMjY0MzczYTVmMGQ0MTVlYTBkMjZlMCIsIm9iaiI6W1t7InBhdGgiOiJcL2ZcL2I1MzhlNTM1LWI1MTktNDhlMS04NWM3LTI2YTU4OTZhN2UwYVwvZGVzcG5uaS0wNzQ0MzFkNi04OGFhLTQ1ZWYtYTllZS00ZmI5NTI0OWRjOWUucG5nIn1dXSwiYXVkIjpbInVybjpzZXJ2aWNlOmZpbGUuZG93bmxvYWQiXX0.xbki5e5kD-8Dl0tIX3jbyuHNOgGlJGgTsJZ8jr6KIro' },
                    { name: 'moneybag', imageUrl: 'https://static.vecteezy.com/system/resources/thumbnails/024/724/482/small_2x/railroad-track-isolated-on-transparent-background-generative-ai-railway-track-png.png' },
                    { name: 'star', imageUrl: 'https://upload.wikimedia.org/wikipedia/en/thumb/1/12/Flag_of_Poland.svg/1200px-Flag_of_Poland.svg.png' }
                ];

                // Payout rules: now using symbol names
                const payoutRules = [
                    { combo: ['diamond', 'diamond', 'diamond'], multiplier: 100, message: "JACKPOT! THREE DIAMONDS!" },
                    { combo: ['bell', 'bell', 'bell'], multiplier: 50, message: "BIG WIN! THREE BELLS!" },
                    { combo: ['moneybag', 'moneybag', 'moneybag'], multiplier: 30, message: "LUCKY! THREE MONEY BAGS!" },
                    { combo: ['clover', 'clover', 'clover'], multiplier: 20, message: "FORTUNE! THREE CLOVERS!" },
                    { combo: ['cherry', 'cherry', 'cherry'], multiplier: 15, message: "SWEET! THREE CHERRIES!" },
                    { combo: ['star', 'star', 'star'], multiplier: 10, message: "SHINY! THREE STARS!" },
                    { combo: ['grape', 'grape', 'grape'], multiplier: 8, message: "JUICY! THREE GRAPES!" },
                    { combo: ['orange', 'orange', 'orange'], multiplier: 7, message: "TANGY! THREE ORANGES!" },
                    { combo: ['lemon', 'lemon', 'lemon'], multiplier: 6, message: "ZINGY! THREE LEMONS!" },
                    { combo: ['cherry', 'cherry', null], multiplier: 3, message: "TWO CHERRIES!" } // Any two cherries on first two reels
                ];

                /**
                 * Sets the current bet amount.
                 * @param {number} amount - The amount to set the bet to.
                 */
                function setBet(amount) {
                    if (!isSpinning) {
                        bet = Math.min(amount, balance); // Ensure bet doesn't exceed balance
                        updateDisplay();
                        displayGameMessage(`BET SET TO $${bet}`);
                    }
                }

                /**
                 * Updates the display of balance and bet.
                 */
                function updateDisplay() {
                    balanceDisplay.textContent = balance;
                    betDisplay.textContent = bet;
                    // Disable/enable bet buttons based on current bet and spinning state
                    bet1Button.disabled = isSpinning || balance < 1;
                    bet5Button.disabled = isSpinning || balance < 5;
                    bet10Button.disabled = isSpinning || balance < 10;
                    maxBetButton.disabled = isSpinning || balance === 0; // Max bet disabled if balance is 0
                    spinButton.disabled = balance < bet || isSpinning;
                    cashOutButton.disabled = isSpinning;
                }

                /**
                 * Displays a message in the game's message box.
                 * @param {string} msg - The message to display.
                 * @param {string} type - 'win', 'lose', or 'info'.
                 */
                function displayGameMessage(msg, type = 'info') {
                    messageBox.textContent = msg;
                    messageBox.className = 'message-box'; // Reset classes
                    if (type === 'win') {
                        messageBox.classList.add('text-green-400', 'font-bold');
                    } else if (type === 'lose') {
                        messageBox.classList.add('text-red-400', 'font-bold');
                    } else {
                        messageBox.classList.add('text-white');
                    }
                }

                /**
                 * Shows a custom modal with a title and message.
                 * @param {string} title - The title for the modal.
                 * @param {string} message - The message content.
                 * @param {boolean} isWin - True if it's a win message, false otherwise.
                 */
                function showModal(title, message, isWin = false) {
                    modalTitle.textContent = title;
                    modalMessage.textContent = message;
                    messageModalOverlay.classList.add('show');

                    if (isWin) {
                        // Add confetti effect
                        for (let i = 0; i < 50; i++) {
                            const confetti = document.createElement('div');
                            confetti.classList.add('confetti-piece');
                            confetti.style.left = `${Math.random() * 100}%`;
                            confetti.style.animationDelay = `${Math.random() * 0.5}s`;
                            confetti.style.backgroundColor = `hsl(${Math.random() * 360}, 100%, 70%)`; // Random color
                            document.body.appendChild(confetti);
                            confetti.addEventListener('animationend', () => confetti.remove());
                        }
                    }
                }

                /**
                 * Hides the custom modal.
                 */
                function hideModal() {
                    modalMessage.textContent = ""; // Clear message when closing
                    messageModalOverlay.classList.remove('show');
                }

                /**
                 * Generates a random symbol object (name and imageUrl).
                 * @returns {object} A random symbol object from symbolData.
                 */
                function getRandomSymbol() {
                    return symbolData[Math.floor(Math.random() * symbolData.length)];
                }

                /**
                 * Checks the spun reels for winning combinations and calculates payout.
                 * @param {string[]} resultSymbolNames - An array of symbol names from the reels.
                 * @returns {object} An object containing payout and winMessage.
                 */
                function checkWin(resultSymbolNames) {
                    let payout = 0;
                    let winMessage = '';

                    // Check for specific payout rules first (e.g., three of a kind)
                    for (const rule of payoutRules) {
                        const [s1, s2, s3] = rule.combo;

                        if (s3 === null) { // Special case for two of a kind (e.g., two cherries)
                            if (resultSymbolNames[0] === s1 && resultSymbolNames[1] === s2) {
                                payout = bet * rule.multiplier;
                                winMessage = rule.message;
                                break;
                            }
                        } else if (resultSymbolNames[0] === s1 && resultSymbolNames[1] === s2 && resultSymbolNames[2] === s3) {
                            payout = bet * rule.multiplier;
                            winMessage = rule.message;
                            break;
                        }
                    }

                    return { payout, winMessage };
                }

                /**
                 * Simulates the spinning of the slot machine reels.
                 */
                async function spin() {
                    if (isSpinning || balance < bet) {
                        if (balance < bet) {
                            showModal("INSUFFICIENT FUNDS", `YOU NEED AT LEAST $${bet} TO SPIN. YOUR CURRENT BALANCE IS $${balance}.`);
                        }
                        return;
                    }

                    isSpinning = true;
                    balance -= bet;
                    updateDisplay();
                    displayGameMessage("SPINNING...");

                    if (isSfxEnabled && spinSynth) {
                        spinSynth.triggerAttackRelease("C2", "0.2"); // Play a low, short tone for spin
                    }
                    if (isSfxEnabled && reelSpinningNoise) {
                        reelSpinningNoise.triggerAttack(); // Start continuous spinning noise
                    }


                    const finalSymbolNames = [];
                    const spinPromises = reelElements.map((reel, index) => {
                        return new Promise(resolve => {
                            // Clear existing content and add an image element if not already present
                            if (!reel.querySelector('.reel-image')) {
                                reel.innerHTML = '<img src="" class="reel-image">';
                            }
                            const symbolImageElement = reel.querySelector('.reel-image');

                            reel.classList.add('spinning'); // Add spinning animation class

                            // Simulate multiple spins before landing on final symbol
                            let spinCount = 0;
                            const totalSpins = 20 + (index * 5); // Staggered stop
                            const spinInterval = setInterval(() => {
                                const randomSymbol = getRandomSymbol();
                                symbolImageElement.src = randomSymbol.imageUrl;
                                // Add onerror to handle broken image links
                                symbolImageElement.onerror = () => {
                                    symbolImageElement.src = 'https://placehold.co/100x100/CCCCCC/000000?text=ERROR'; // Fallback image
                                };
                                spinCount++;
                                if (spinCount >= totalSpins) {
                                    clearInterval(spinInterval);
                                    reel.classList.remove('spinning');
                                    const finalSymbol = getRandomSymbol(); // Get the actual final symbol object
                                    symbolImageElement.src = finalSymbol.imageUrl;
                                    // Add onerror to handle broken image links for final symbol
                                    symbolImageElement.onerror = () => {
                                        symbolImageElement.src = 'https://placehold.co/100x100/CCCCCC/000000?text=ERROR'; // Fallback image
                                    };
                                    finalSymbolNames[index] = finalSymbol.name; // Store the name for win checking
                                    resolve();
                                }
                            }, 50); // Faster spin visual
                        });
                    });

                    // Wait for all reels to stop
                    await Promise.all(spinPromises);

                    isSpinning = false;
                    if (isSfxEnabled && reelSpinningNoise) {
                        reelSpinningNoise.triggerRelease(); // Stop continuous spinning noise
                    }
                    updateDisplay();

                    const { payout, winMessage } = checkWin(finalSymbolNames);

                    if (payout > 0) {
                        balance += payout;
                        updateDisplay();
                        showModal("YOU WIN!", `${winMessage} YOU WON $${payout}!`, true);
                        displayGameMessage(`YOU WON $${payout}!`, 'win');
                        if (isSfxEnabled && winSynth) {
                            // Play ascending chime notes sequentially
                            const winNotes = ["C5", "E5", "G5", "C6"];
                            winNotes.forEach((note, i) => {
                                winSynth.triggerAttackRelease(note, "8n", Tone.context.currentTime + i * 0.1);
                            });
                        }
                    } else {
                        // No win pop-up removed, message displayed in message box
                        displayGameMessage("NO WIN. TRY AGAIN!", 'lose');
                        if (isSfxEnabled && loseSynth) {
                            // Play descending tone notes sequentially
                            const loseNotes = ["C3", "A2"];
                            loseNotes.forEach((note, i) => {
                                loseSynth.triggerAttackRelease(note, "8n", Tone.context.currentTime + i * 0.1);
                            });
                        }
                    }
                    updateDisplay(); // Update display again after showing modal in case balance changed
                }

                /**
                 * Sets the bet to the maximum possible amount (current balance).
                 */
                function maxBet() {
                    if (!isSpinning && balance > 0) {
                        bet = balance;
                        updateDisplay();
                        displayGameMessage(`BET SET TO MAX ($${bet})`);
                    } else if (balance === 0) {
                        displayGameMessage("CANNOT MAX BET WITH $0 BALANCE.", 'lose');
                    }
                }

                /**
                 * Cashes out the current balance and resets the game.
                 */
                function cashOut() {
                    if (isSpinning) return;

                    showModal("CASH OUT", `YOU CASHED OUT WITH $${balance}. THANKS FOR PLAYING AKI'S CHANCE!`);
                    balance = 100; // Reset balance for a new game
                    bet = 1;      // Reset bet
                    updateDisplay();
                    displayGameMessage("GAME RESET. WELCOME BACK!", 'info');
                }

                /**
                 * Toggles the background music on and off using the YouTube player.
                 */
                function toggleMusic() {
                    if (!player) {
                        showModal("MUSIC PLAYER NOT READY", "YOUTUBE PLAYER IS STILL LOADING. PLEASE TRY AGAIN IN A MOMENT.");
                        return;
                    }

                    // Check player state to determine if it's currently playing
                    if (player.getPlayerState() === YT.PlayerState.PLAYING) {
                        player.pauseVideo();
                    } else {
                        player.playVideo();
                    }
                    // The onPlayerStateChange event will update isMusicPlaying and button text
                }

                /**
                 * Toggles sound effects on and off.
                 */
                function toggleSfx() {
                    isSfxEnabled = !isSfxEnabled;
                    sfxToggleButton.textContent = `SFX: ${isSfxEnabled ? 'ON' : 'OFF'}`;
                    if (isSfxEnabled) {
                        // Ensure audio context is running when SFX is enabled
                        initAudioContext();
                    } else {
                        // Stop any currently playing SFX when disabled
                        if (reelSpinningNoise) reelSpinningNoise.triggerRelease();
                    }
                }


                // Event Listeners
                spinButton.addEventListener('click', spin);
                bet1Button.addEventListener('click', () => setBet(1)); // Event listener for BET $1
                bet5Button.addEventListener('click', () => setBet(5)); // Event listener for BET $5
                bet10Button.addEventListener('click', () => setBet(10)); // Event listener for BET $10
                maxBetButton.addEventListener('click', maxBet);
                cashOutButton.addEventListener('click', cashOut);
                musicToggleButton.addEventListener('click', toggleMusic);
                sfxToggleButton.addEventListener('click', toggleSfx); // SFX toggle button listener
                modalCloseButton.addEventListener('click', hideModal);
                modalOkButton.addEventListener('click', hideModal);

                // Initial display update when the page loads
                updateDisplay();
            });
        })();
    </script>
</body>
</html>
