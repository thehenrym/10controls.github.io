<!DOCTYPE html>
<html lang="en">
<head>
<link rel="icon" type="image/png" href="favicon/favicon-96x96.png" sizes="96x96" />
<link rel="icon" type="image/svg+xml" href="favicon/favicon.svg" />
<link rel="shortcut icon" href="favicon/favicon.ico" />
<link rel="apple-touch-icon" sizes="180x180" href="favicon/apple-touch-icon.png" />
<meta name="apple-mobile-web-app-title" content="10 Controls" />
<link rel="manifest" href="favicon/site.webmanifest" />
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>10 Controls</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(to bottom, #492833, #201C1C);
            min-height: 100vh;
        }
        .footer {
            background-color: #492833;
            color: white;
            text-align: center;
            padding: 2rem 1rem;
        }
        #mobile-menu {
            max-height: 0;
            opacity: 0;
            overflow: hidden;
            transition: max-height 0.5s ease-in-out, opacity 0.5s ease-in-out;
            position: absolute;
            width: 100%;
            left: 0;
            top: 100%;
            background-color: #492833;
        }
        #mobile-menu.menu-open {
            max-height: 25rem;
            opacity: 1;
        }
        #desktop-menu-items {
            position: relative;
        }
        #sliding-highlighter {
            position: absolute;
            top: 0;
            left: 0;
            width: 0;
            height: 100%;
            background-color: #492833;
            border-radius: 0.375rem;
            transition: left 0.3s ease-in-out, width 0.3s ease-in-out;
            z-index: -1;
        }
        .hamburger-icon span {
            display: block;
            width: 24px;
            height: 2px;
            background-color: white;
            transition: all 0.3s cubic-bezier(.08,.82,.17,1);
        }
        #mobile-menu-button.open .hamburger-icon span:nth-child(1) {
            transform: translateY(10px) rotate(45deg);
        }
        #mobile-menu-button.open .hamburger-icon span:nth-child(2) {
            opacity: 0;
        }
        #mobile-menu-button.open .hamburger-icon span:nth-child(3) {
            transform: translateY(-10px) rotate(-45deg);
        }
        .mobile-menu-link {
            background-color: #492833;
            transition: background-color 0.2s ease-in-out;
        }
        .mobile-menu-link:hover {
            background-color: #000000;
        }
        .font-display {
            font-family: 'Inter', sans-serif;
        }
    </style>
</head>
<body class="font-medium">

    <header class="bg-black/70 backdrop-blur-sm sticky top-0 z-50 shadow-lg">
        <nav class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-20">
                <div class="flex-shrink-0">
                    <a href="index.html">
                        <img src="images/10c.png" alt="10 Controls Logo" class="h-10" onerror="this.onerror=null;this.src='https://placehold.co/100x40/492833/FFFFFF?text=Logo';">
                    </a>
                </div>
                <div id="desktop-menu-items" class="hidden md:flex items-center space-x-4">
                    <div id="sliding-highlighter"></div>
                    <a href="latest.html" class="text-gray-300 hover:text-white px-3 py-2 rounded-md text-sm font-medium relative z-10">Latest</a>
                    <a href="schedule.html" class="text-gray-300 hover:text-white px-3 py-2 rounded-md text-sm font-medium relative z-10">Schedule</a>
                    <a href="standings.html" class="text-gray-300 hover:text-white px-3 py-2 rounded-md text-sm font-medium relative z-10">Standings</a>
                    <a href="teams.html" class="text-gray-300 hover:text-white px-3 py-2 rounded-md text-sm font-medium relative z-10">Teams</a>
                    <a href="https://discord.gg/khYF6xE5rq" target="_blank" rel="noopener noreferrer" class="text-gray-300 hover:text-white px-3 py-2 rounded-md text-sm font-medium relative z-10">Join Now</a>
                </div>
                <div class="-mr-2 flex md:hidden">
                    <button type="button" id="mobile-menu-button" class="inline-flex items-center justify-center p-2 rounded-md text-white focus:outline-none" style="background-color: #492833;">
                        <span class="sr-only">Open main menu</span>
                        <div class="hamburger-icon space-y-2">
                            <span></span><span></span><span></span>
                        </div>
                    </button>
                </div>
            </div>
        </nav>
        <div class="md:hidden" id="mobile-menu">
            <div class="px-2 pt-2 pb-3 space-y-1">
                <a href="latest.html" class="text-white block px-3 py-2 rounded-md text-base font-medium mobile-menu-link">Latest</a>
                <a href="schedule.html" class="text-white block px-3 py-2 rounded-md text-base font-medium mobile-menu-link">Schedule</a>
                <a href="standings.html" class="text-white block px-3 py-2 rounded-md text-base font-medium mobile-menu-link">Standings</a>
                <a href="teams.html" class="text-white block px-3 py-2 rounded-md text-base font-medium mobile-menu-link">Teams</a>
                <a href="https://discord.gg/khYF6xE5rq" target="_blank" rel="noopener noreferrer" class="text-white block px-3 py-2 rounded-md text-base font-medium mobile-menu-link">Join Now</a>
            </div>
        </div>
    </header>

    <!-- Sub-Header for Upcoming Race Info -->
    <div id="sub-header" class="bg-black text-white h-12 transition-opacity duration-300 hidden md:flex">
        <div class="max-w-7xl mx-auto px-2 sm:px-6 lg:px-8 flex items-center justify-between h-full w-full">
            <div class="flex items-center space-x-2 sm:space-x-4">
                <div id="upcoming-race-info" class="text-xs sm:text-sm font-semibold truncate"></div>
                <div id="upcoming-race-date" class="text-xs bg-gray-700/50 px-2 py-1 rounded-md hidden sm:block"></div>
            </div>
            <!-- Countdown Timer instead of "MY TIME" and "TRACK TIME" -->
            <div id="countdown-display" class="flex items-center flex-shrink-0 text-right text-xs sm:text-sm">
                <p id="countdown-timer" class="font-bold"></p>
            </div>
        </div>
    </div>

    <!-- Driver Profile and Stats Section -->
    <div id="driver-profile-section" style="background: linear-gradient(to bottom, #492833, #201C1C);">
        <!-- Driver Info Banner -->
        <div id="driver-banner" class="relative flex flex-col md:flex-row items-center justify-between p-8 md:p-12 overflow-hidden">
            <div class="relative z-10 text-center md:text-left flex-shrink-0 mb-8 md:mb-0">
                <h1 id="driver-name" class="font-display text-4xl sm:text-5xl md:text-7xl lg:text-8xl font-bold text-white uppercase"></h1>
                <p id="driver-details" class="flex items-center justify-center md:justify-start text-sm md:text-base text-white mt-2">
                    <img id="driver-flag" src="" alt="Driver Flag" class="h-4 w-auto mr-2 inline-block">
                    <span id="driver-country"></span> <span class="mx-2">•</span>
                    <img id="team-icon" src="" alt="Team Icon" class="h-5 w-auto mr-2 inline-block">
                    <span id="driver-team"></span>
                </p>
            </div>
            <div class="relative z-10 flex-shrink-0">
                <img id="driver-car-img" src="" alt="F1 Car" class="w-56 md:w-80 h-auto rounded-lg shadow-2xl transform hover:scale-105 transition-transform duration-300">
            </div>
        </div>

        <!-- Statistics Section -->
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:p-8 py-12">
            <h2 class="text-3xl font-bold text-white mb-8 uppercase">Statistics</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-12">
                <!-- 2025 Season Stats -->
                <div>
                    <h3 class="text-xl font-bold text-white mb-6 uppercase">2025 Season</h3>
                    <div id="season-stats-grid" class="grid grid-cols-2 gap-y-4 gap-x-2 text-white"></div>
                </div>
                <!-- Career Stats -->
                <div>
                    <h3 class="text-xl font-bold text-white mb-6 uppercase">Career Stats</h3>
                    <div id="career-stats-grid" class="grid grid-cols-2 gap-y-4 gap-x-2 text-white"></div>
                </div>
            </div>
        </div>
        
        <!-- Recent Races Table Section -->
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:p-8 pt-0 pb-24">
            <h2 class="text-3xl font-bold text-white mb-8 uppercase">Recent Races</h2>
            <div class="rounded-lg shadow-lg overflow-x-auto" style="background-color: #492833;">
                <table class="w-full text-white text-sm">
                    <thead class="border-b border-gray-500">
                        <tr>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider">Grand Prix</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider">Pos</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider">Grid</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider">Stops</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider">Result</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider">Pts</th>
                        </tr>
                    </thead>
                    <tbody id="recent-races-tbody">
                        <!-- Race rows will be injected here by JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Social Media Links & Copyright Footer -->
    <footer class="bg-black text-white text-center py-5 px-2">
        <div class="max-w-7xl mx-auto flex justify-center items-center space-x-6">
            <a href="https://www.twitch.tv/10controls" target="_blank" rel="noopener noreferrer" class="text-white hover:text-gray-300 transition-colors" aria-label="Twitch"><i class="fab fa-twitch fa-lg"></i></a>
            <a href="https://www.instagram.com/10controls/" target="_blank" rel="noopener noreferrer" class="text-white hover:text-gray-300 transition-colors" aria-label="Instagram"><i class="fab fa-instagram fa-lg"></i></a>
            <a href="https://www.youtube.com/@10controls24" target="_blank" rel="noopener noreferrer" class="text-white hover:text-gray-300 transition-colors" aria-label="YouTube"><i class="fab fa-youtube fa-lg"></i></a>
            <a href="https://discord.gg/khYF6xE5rq" target="_blank" rel="noopener noreferrer" class="text-white hover:text-gray-300 transition-colors" aria-label="Discord"><i class="fab fa-discord fa-lg"></i></a>
        </div>
    </footer>
    <footer class="footer">
        <p>© 2022-2025 10 Controls Limited</p>
    </footer>
    
    <script>
        // --- DATA STORE ---
        const teamColors = {
            'HOT WHEELS MCLAREN': '#FF8000', 'NEWPORT ROLEX RED BULL RACING': '#003773', 'GUINNESS MERCEDES': '#C8CCCE',
            'RACING BULLS PEUGEOT SPORT': '#BBDA0C', 'SCUDERIA FERRARI HP': '#821729', 'LOCKHEED MARTIN ASTON MARTIN': '#037A68',
            'TINDER ALPINE F1 TEAM': '#F282B4', 'HAAS ONLYFANS RACING': '#00AFF0', 'JOHN DEERE WILLIAMS RACING': '#00A0DE',
            'KICK SAUBER': '#9146FF', 'TWITCH SAUBER': '#9146FF', 'Placeholder Team': '#333333'
        };

        const teamIcons = {
            "HOT WHEELS MCLAREN": 'https://cdn.discordapp.com/emojis/1378699086982811679.webp?size=44', "NEWPORT ROLEX RED BULL RACING": 'https://cdn.discordapp.com/emojis/1378696277180813312.webp?size=44',
            "SCUDERIA FERRARI HP": 'https://cdn.discordapp.com/emojis/1215769617272934440.webp?size=44', "GUINNESS MERCEDES": 'https://cdn.discordapp.com/emojis/1386054950496243732.webp?size=44',
            "LOCKHEED MARTIN ASTON MARTIN": 'https://cdn.discordapp.com/emojis/1215769484078354483.webp?size=44', "RACING BULLS PEUGEOT SPORT": 'https://cdn.discordapp.com/emojis/1377646844578103346.webp?size=44',
            "TINDER ALPINE F1 TEAM": 'https://cdn.discordapp.com/emojis/1379862213493260328.webp?size=44', "HAAS ONLYFANS RACING": 'https://cdn.discordapp.com/emojis/1378698433652588645.webp?size=44',
            "TWITCH SAUBER": 'https://cdn.discordapp.com/emojis/1379957079900688515.webp?size=44', "JOHN DEERE WILLIAMS RACING": 'https://cdn.discordapp.com/emojis/1377791374341963917.webp?size=44',
            "KICK SAUBER": 'https://cdn.discordapp.com/emojis/1379957079900688515.webp?size=44'
        };

        const tier1DriverKeys = [
            'focuser', 'maxfan1982', 'antonchebotarov', 'sebeinkro', 'mora', 'tonyseroka',
            'maxhousley', 'tsar', 'counterfeit', 'alpharomeo127', 'lucastevens', 'stra',
            'antoniobrancati', 'jstnnl', 'nojusgedvilas', 'aspec33', 'edge', 'shengen',
            'rabas', 'maxlinxc', 'aruthlessguy', 'loler', 'c3z4r', 'yuliankalenantovich',
            'theromaniandevil', 'lukas'
        ];
        const tier2DriverKeys = [
            'jayazier', 'machmudmoerwijk', 'manuelrotundo', 'maxammerlaan', 'jarviscoid',
            'teetoe', 'byronas', 'tuki', 'mark', 'shark', 'daniels', 'spyzer', 'sneeuw',
            'scorenzy', 'formulaphantom', 'kevinjerling', 'caiomhe', 'phoenix', 'rookie', 'sandro'
        ];

        const driverData = {
            'focuser': { name: 'FOCUSER', team: 'HOT WHEELS MCLAREN', country: 'SPAIN', flagUrl: 'https://cdn-icons-png.flaticon.com/128/197/197593.png', carImageUrl: 'https://media.formula1.com/image/upload/v1716474051/fom-website/2024/VIAPLAY/McLaren%20MCL38/MCL38_Sainz_V1_s.png.transform/4col-retina/image.png', baseCareerStats: { 'Grand Prix Entered': 55, 'Wins': 0, 'Podiums': 7, 'Career Points': 351, 'Pole Positions': 0, 'DNFs': 1, 'World Championships': 0 } },
            'maxfan1982': { name: 'MAXFAN1982', team: 'NEWPORT ROLEX RED BULL RACING', country: 'POLAND', flagUrl: 'https://cdn-icons-png.flaticon.com/128/197/197529.png', carImageUrl: 'https://media.formula1.com/image/upload/v1716474050/fom-website/2024/VIAPLAY/Red%20Bull%20RB20/RB20_Verstappen_V1_s.png.transform/4col-retina/image.png', baseCareerStats: { 'Grand Prix Entered': 29, 'Wins': 1, 'DNFs': 6, 'Pole Positions': 0, 'Career Points': 114, 'Podiums': 1, 'World Championships': 0 } },
            'antonchebotarov': { name: 'ANTON CHEBOTAROV', team: 'HOT WHEELS MCLAREN', country: 'UKRAINE', flagUrl: 'https://cdn-icons-png.flaticon.com/128/197/197572.png', carImageUrl: 'https://media.formula1.com/image/upload/v1716474051/fom-website/2024/VIAPLAY/McLaren%20MCL38/MCL38_Sainz_V1_s.png.transform/4col-retina/image.png', baseCareerStats: { 'Grand Prix Entered': 60, 'Wins': 4, 'DNFs': 6, 'Pole Positions': 4, 'Career Points': 410, 'Podiums': 14, 'World Championships': 0 } },
            'sebeinkro': { name: 'SEBEINKRO', team: 'GUINNESS MERCEDES', country: 'DENMARK', flagUrl: 'https://cdn-icons-png.flaticon.com/128/197/197579.png', carImageUrl: 'https://media.formula1.com/image/upload/v1716474050/fom-website/2024/VIAPLAY/Mercedes%20W15/W15_Hamilton_V1_s.png.transform/4col-retina/image.png', baseCareerStats: {'World Championships': 0} },
            'mora': { name: 'MORA', team: 'RACING BULLS PEUGEOT SPORT', country: 'SPAIN', flagUrl: 'https://cdn-icons-png.flaticon.com/128/197/197593.png', carImageUrl: 'https://media.formula1.com/image/upload/v1716474051/fom-website/2024/VIAPLAY/VCARB%2001/VCARB01_Ricciardo_V1_s.png.transform/4col-retina/image.png', baseCareerStats: { 'Grand Prix Entered': 24, 'Wins': 2, 'DNFs': 6, 'Pole Positions': 5, 'Career Points': 178, 'Podiums': 6, 'World Championships': 0 } },
            'tonyseroka': { name: 'TONY SEROKA', team: 'NEWPORT ROLEX RED BULL RACING', country: 'POLAND', flagUrl: 'https://cdn-icons-png.flaticon.com/128/197/197529.png', carImageUrl: 'https://media.formula1.com/image/upload/v1716474050/fom-website/2024/VIAPLAY/Red%20Bull%20RB20/RB20_Verstappen_V1_s.png.transform/4col-retina/image.png', baseCareerStats: { 'Grand Prix Entered': 3, 'Wins': 0, 'DNFs': 1, 'Pole Positions': 0, 'Career Points': 1, 'Podiums': 0, 'World Championships': 0 } },
            'maxhousley': { name: 'MAX HOUSLEY', team: 'TINDER ALPINE F1 TEAM', country: 'UNITED KINGDOM', flagUrl: 'https://cdn-icons-png.flaticon.com/128/197/197374.png', carImageUrl: 'https://media.formula1.com/image/upload/v1716474051/fom-website/2024/VIAPLAY/Alpine%20A524/A524_Ocon_V1_s.png.transform/4col-retina/image.png', baseCareerStats: { 'Grand Prix Entered': 10, 'Wins': 0, 'Podiums': 2, 'Career Points': 72, 'Pole Positions': 0, 'DNFs': 2, 'World Championships': 0 } },
            'tsar': { name: 'TSAR', team: 'RACING BULLS PEUGEOT SPORT', country: 'HUNGARY', flagUrl: 'https://cdn-icons-png.flaticon.com/128/197/197584.png', carImageUrl: 'https://media.formula1.com/image/upload/v1716474051/fom-website/2024/VIAPLAY/VCARB%2001/VCARB01_Ricciardo_V1_s.png.transform/4col-retina/image.png', baseCareerStats: { 'Grand Prix Entered': 4, 'Wins': 0, 'DNFs': 3, 'Pole Positions': 0, 'Career Points': 8, 'Podiums': 0, 'World Championships': 0 } },
            'counterfeit': { name: 'COUNTERFEIT', team: 'TWITCH SAUBER', country: 'UNITED KINGDOM', flagUrl: 'https://cdn-icons-png.flaticon.com/128/197/197374.png', carImageUrl: 'https://media.formula1.com/image/upload/v1716474050/fom-website/2024/VIAPLAY/Kick%20Sauber%20C44/C44_Bottas_V1_s.png.transform/4col-retina/image.png', baseCareerStats: { 'Grand Prix Entered': 50, 'Wins': 0, 'DNFs': 11, 'Pole Positions': 0, 'Career Points': 211, 'Podiums': 3, 'World Championships': 0 } },
            'alpharomeo127': { name: 'ALPHAROMEO127', team: 'SCUDERIA FERRARI HP', country: 'NETHERLANDS', flagUrl: 'https://cdn-icons-png.flaticon.com/128/197/197441.png', carImageUrl: 'https://media.formula1.com/image/upload/v1716474050/fom-website/2024/VIAPLAY/Ferrari%20SF-24/SF-24_Leclerc_V1_s.png.transform/4col-retina/image.png', baseCareerStats: { 'Grand Prix Entered': 34, 'Wins': 4, 'DNFs': 4, 'Pole Positions': 1, 'Career Points': 297, 'Podiums': 13, 'World Championships': 0 } },
            'lucastevens': { name: 'LUCA STEVENS', team: 'LOCKHEED MARTIN ASTON MARTIN', country: 'UNITED KINGDOM', flagUrl: 'https://cdn-icons-png.flaticon.com/128/197/197374.png', carImageUrl: 'https://media.formula1.com/image/upload/v1716474050/fom-website/2024/VIAPLAY/Aston%20Martin%20AMR24/AM24_Stroll_V1_s.png.transform/4col-retina/image.png', baseCareerStats: { 'Grand Prix Entered': 55, 'Wins': 2, 'Podiums': 12, 'Career Points': 310, 'Pole Positions': 0, 'DNFs': 4, 'World Championships': 0 } },
            'stra': { name: 'STRA', team: 'LOCKHEED MARTIN ASTON MARTIN', country: 'SERBIA', flagUrl: 'https://cdn-icons-png.flaticon.com/512/197/197602.png', carImageUrl: 'https://media.formula1.com/image/upload/v1716474050/fom-website/2024/VIAPLAY/Aston%20Martin%20AMR24/AM24_Stroll_V1_s.png.transform/4col-retina/image.png', baseCareerStats: { 'Grand Prix Entered': 28, 'Wins': 0, 'Podiums': 1, 'Career Points': 98, 'Pole Positions': 0, 'DNFs': 7, 'World Championships': 0 } },
            'antoniobrancati': { name: 'ANTONIO BRANCATI', team: 'SCUDERIA FERRARI HP', country: 'ITALY', flagUrl: 'https://cdn-icons-png.flaticon.com/128/197/197626.png', carImageUrl: 'https://media.formula1.com/image/upload/v1716474050/fom-website/2024/VIAPLAY/Ferrari%20SF-24/SF-24_Leclerc_V1_s.png.transform/4col-retina/image.png', baseCareerStats: { 'Grand Prix Entered': 48, 'Wins': 4, 'DNFs': 12, 'Pole Positions': 5, 'Career Points': 310, 'Podiums': 13, 'World Championships': 0 } },
            'jstnnl': { name: 'JSTN NL', team: 'SCUDERIA FERRARI HP', country: 'NETHERLANDS', flagUrl: 'https://cdn-icons-png.flaticon.com/128/197/197441.png', carImageUrl: 'https://media.formula1.com/image/upload/v1716474050/fom-website/2024/VIAPLAY/Ferrari%20SF-24/SF-24_Leclerc_V1_s.png.transform/4col-retina/image.png', baseCareerStats: { 'Grand Prix Entered': 12, 'Wins': 0, 'Podiums': 1, 'Career Points': 67, 'Pole Positions': 0, 'DNFs': 3, 'World Championships': 0 } },
            'nojusgedvilas': { name: 'NOJUS GEDVILAS', team: 'HAAS ONLYFANS RACING', country: 'LITHUANIA', flagUrl: 'https://cdn-icons-png.flaticon.com/512/197/197612.png', carImageUrl: 'https://media.formula1.com/image/upload/v1716474050/fom-website/2024/VIAPLAY/Haas%20VF-24/VF-24_Hulkenberg_V1_s.png.transform/4col-retina/image.png', baseCareerStats: {'World Championships': 0} },
            'aspec33': { name: 'ASPEC33', team: 'TINDER ALPINE F1 TEAM', country: 'ITALY', flagUrl: 'https://cdn-icons-png.flaticon.com/128/197/197626.png', carImageUrl: 'https://media.formula1.com/image/upload/v1716474051/fom-website/2024/VIAPLAY/Alpine%20A524/A524_Ocon_V1_s.png.transform/4col-retina/image.png', baseCareerStats: {'World Championships': 0} },
            'edge': { name: 'EDGE', team: 'HAAS ONLYFANS RACING', country: 'POLAND', flagUrl: 'https://cdn-icons-png.flaticon.com/128/197/197529.png', carImageUrl: 'https://media.formula1.com/image/upload/v1716474050/fom-website/2024/VIAPLAY/Haas%20VF-24/VF-24_Hulkenberg_V1_s.png.transform/4col-retina/image.png', baseCareerStats: {'World Championships': 0} },
            'shengen': { name: 'SHENGEN', team: 'GUINNESS MERCEDES', country: 'FINLAND', flagUrl: 'https://cdn-icons-png.flaticon.com/128/197/197585.png', carImageUrl: 'https://media.formula1.com/image/upload/v1716474050/fom-website/2024/VIAPLAY/Mercedes%20W15/W15_Hamilton_V1_s.png.transform/4col-retina/image.png', baseCareerStats: {'World Championships': 0} },
            'rabas': { name: 'RABAS', team: 'JOHN DEERE WILLIAMS RACING', country: 'SPAIN', flagUrl: 'https://cdn-icons-png.flaticon.com/128/197/197593.png', carImageUrl: 'https://media.formula1.com/image/upload/v1716474051/fom-website/2024/VIAPLAY/Williams%20FW46/FW46_Albon_V1_s.png.transform/4col-retina/image.png', baseCareerStats: {'World Championships': 0} },
            'maxlinxc': { name: 'MAXLINXC', team: 'HAAS ONLYFANS RACING', country: 'NETHERLANDS', flagUrl: 'https://cdn-icons-png.flaticon.com/128/197/197441.png', carImageUrl: 'https://media.formula1.com/image/upload/v1716474050/fom-website/2024/VIAPLAY/Haas%20VF-24/VF-24_Hulkenberg_V1_s.png.transform/4col-retina/image.png', baseCareerStats: {'World Championships': 0} },
            'aruthlessguy': { name: 'A RUTHLESS GUY', team: 'TINDER ALPINE F1 TEAM', country: 'POLAND', flagUrl: 'https://cdn-icons-png.flaticon.com/128/197/197529.png', carImageUrl: 'https://media.formula1.com/image/upload/v1716474051/fom-website/2024/VIAPLAY/Alpine%20A524/A524_Ocon_V1_s.png.transform/4col-retina/image.png', baseCareerStats: {'World Championships': 0} },
            'loler': { name: 'LOLER', team: 'JOHN DEERE WILLIAMS RACING', country: 'POLAND', flagUrl: 'https://cdn-icons-png.flaticon.com/128/197/197529.png', carImageUrl: 'https://media.formula1.com/image/upload/v1716474051/fom-website/2024/VIAPLAY/Williams%20FW46/FW46_Albon_V1_s.png.transform/4col-retina/image.png', baseCareerStats: {'World Championships': 0} },
            'c3z4r': { name: 'C3Z4R', team: 'TWITCH SAUBER', country: 'BELGIUM', flagUrl: 'https://cdn-icons-png.flaticon.com/512/197/197583.png', carImageUrl: 'https://media.formula1.com/image/upload/v1716474050/fom-website/2024/VIAPLAY/Kick%20Sauber%20C44/C44_Bottas_V1_s.png.transform/4col-retina/image.png', baseCareerStats: {'World Championships': 0} },
            'yuliankalenantovich': { name: 'YULIAN KALENANTOVICH', team: 'TWITCH SAUBER', country: 'UKRAINE', flagUrl: 'https://cdn-icons-png.flaticon.com/128/197/197572.png', carImageUrl: 'https://media.formula1.com/image/upload/v1716474050/fom-website/2024/VIAPLAY/Kick%20Sauber%20C44/C44_Bottas_V1_s.png.transform/4col-retina/image.png', baseCareerStats: { 'Grand Prix Entered': 7, 'Wins': 0, 'DNFs': 3, 'Pole Positions': 0, 'Career Points': 4, 'Podiums': 0, 'World Championships': 0 } },
            'theromaniandevil': { name: 'THE ROMANIAN DEVIL', team: 'GUINNESS MERCEDES', country: 'ROMANIA', flagUrl: 'https://cdn-icons-png.flaticon.com/128/197/197587.png', carImageUrl: 'https://media.formula1.com/image/upload/v1716474050/fom-website/2024/VIAPLAY/Mercedes%20W15/W15_Hamilton_V1_s.png.transform/4col-retina/image.png', baseCareerStats: {'World Championships': 0} },
            'lukas': { name: 'LUKAS', team: 'HAAS ONLYFANS RACING', country: 'POLAND', flagUrl: 'https://cdn-icons-png.flaticon.com/128/197/197529.png', carImageUrl: 'https://media.formula1.com/image/upload/v1716474050/fom-website/2024/VIAPLAY/Haas%20VF-24/VF-24_Hulkenberg_V1_s.png.transform/4col-retina/image.png', baseCareerStats: { 'Grand Prix Entered': 21, 'Wins': 1, 'Podiums': 4, 'Career Points': 99, 'Pole Positions': 1, 'DNFs': 9, 'World Championships': 0 } },
            'jayazier': { name: 'JAYAZIER', team: 'HOT WHEELS MCLAREN', country: 'NETHERLANDS', flagUrl: 'https://cdn-icons-png.flaticon.com/128/197/197441.png', carImageUrl: 'https://media.formula1.com/image/upload/v1716474051/fom-website/2024/VIAPLAY/McLaren%20MCL38/MCL38_Sainz_V1_s.png.transform/4col-retina/image.png', baseCareerStats: {} },
            'sandro': { name: 'SANDRO', team: 'HOT WHEELS MCLAREN', country: 'NETHERLANDS', flagUrl: 'https://cdn-icons-png.flaticon.com/128/197/197441.png', carImageUrl: 'https://media.formula1.com/image/upload/v1716474051/fom-website/2024/VIAPLAY/McLaren%20MCL38/MCL38_Sainz_V1_s.png.transform/4col-retina/image.png', baseCareerStats: {} },
            'manuelrotundo': { name: 'MANUEL ROTUNDO', team: 'SCUDERIA FERRARI HP', country: 'ITALY', flagUrl: 'https://cdn-icons-png.flaticon.com/128/197/197626.png', carImageUrl: 'https://media.formula1.com/image/upload/v1716474050/fom-website/2024/VIAPLAY/Ferrari%20SF-24/SF-24_Leclerc_V1_s.png.transform/4col-retina/image.png', baseCareerStats: {} },
            'maxammerlaan': { name: 'MAX AMMERLAAN', team: 'RACING BULLS PEUGEOT SPORT', country: 'NETHERLANDS', flagUrl: 'https://cdn-icons-png.flaticon.com/128/197/197441.png', carImageUrl: 'https://media.formula1.com/image/upload/v1716474051/fom-website/2024/VIAPLAY/VCARB%2001/VCARB01_Ricciardo_V1_s.png.transform/4col-retina/image.png', baseCareerStats: {} },
            'jarviscoid': { name: 'JARVIS COID', team: 'TWITCH SAUBER', country: 'UNITED KINGDOM', flagUrl: 'https://cdn-icons-png.flaticon.com/128/197/197374.png', carImageUrl: 'https://media.formula1.com/image/upload/v1716474050/fom-website/2024/VIAPLAY/Kick%20Sauber%20C44/C44_Bottas_V1_s.png.transform/4col-retina/image.png', baseCareerStats: {} },
            'teetoe': { name: 'TEETOE', team: 'NEWPORT ROLEX RED BULL RACING', country: 'NETHERLANDS', flagUrl: 'https://cdn-icons-png.flaticon.com/128/197/197441.png', carImageUrl: 'https://media.formula1.com/image/upload/v1716474050/fom-website/2024/VIAPLAY/Red%20Bull%20RB20/RB20_Verstappen_V1_s.png.transform/4col-retina/image.png', baseCareerStats: {} },
            'byronas': { name: 'BYRONAS', team: 'GUINNESS MERCEDES', country: 'GREECE', flagUrl: 'https://cdn-icons-png.flaticon.com/128/197/197566.png', carImageUrl: 'https://media.formula1.com/image/upload/v1716474050/fom-website/2024/VIAPLAY/Mercedes%20W15/W15_Hamilton_V1_s.png.transform/4col-retina/image.png', baseCareerStats: {} },
            'tuki': { name: 'TUKI', team: 'TINDER ALPINE F1 TEAM', country: 'FINLAND', flagUrl: 'https://cdn-icons-png.flaticon.com/128/197/197585.png', carImageUrl: 'https://media.formula1.com/image/upload/v1716474051/fom-website/2024/VIAPLAY/Alpine%20A524/A524_Ocon_V1_s.png.transform/4col-retina/image.png', baseCareerStats: {} },
            'mark': { name: 'MARK', team: 'JOHN DEERE WILLIAMS RACING', country: 'USA', flagUrl: 'https://cdn-icons-png.flaticon.com/128/197/197484.png', carImageUrl: 'https://media.formula1.com/image/upload/v1716474051/fom-website/2024/VIAPLAY/Williams%20FW46/FW46_Albon_V1_s.png.transform/4col-retina/image.png', baseCareerStats: {} },
            'shark': { name: 'SHARK', team: 'LOCKHEED MARTIN ASTON MARTIN', country: 'USA', flagUrl: 'https://cdn-icons-png.flaticon.com/128/197/197484.png', carImageUrl: 'https://media.formula1.com/image/upload/v1716474050/fom-website/2024/VIAPLAY/Aston%20Martin%20AMR24/AM24_Stroll_V1_s.png.transform/4col-retina/image.png', baseCareerStats: {} },
            'daniels': { name: 'DANIELS', team: 'RACING BULLS PEUGEOT SPORT', country: 'SPAIN', flagUrl: 'https://cdn-icons-png.flaticon.com/128/197/197593.png', carImageUrl: 'https://media.formula1.com/image/upload/v1716474051/fom-website/2024/VIAPLAY/VCARB%2001/VCARB01_Ricciardo_V1_s.png.transform/4col-retina/image.png', baseCareerStats: {} },
            'spyzer': { name: 'SPYZER', team: 'TWITCH SAUBER', country: 'GERMANY', flagUrl: 'https://cdn-icons-png.flaticon.com/128/197/197571.png', carImageUrl: 'https://media.formula1.com/image/upload/v1716474050/fom-website/2024/VIAPLAY/Kick%20Sauber%20C44/C44_Bottas_V1_s.png.transform/4col-retina/image.png', baseCareerStats: {} },
            'sneeuw': { name: 'SNEEUW', team: 'LOCKHEED MARTIN ASTON MARTIN', country: 'NETHERLANDS', flagUrl: 'https://cdn-icons-png.flaticon.com/128/197/197441.png', carImageUrl: 'https://media.formula1.com/image/upload/v1716474050/fom-website/2024/VIAPLAY/Aston%20Martin%20AMR24/AM24_Stroll_V1_s.png.transform/4col-retina/image.png', baseCareerStats: {} },
            'scorenzy': { name: 'SCORENZY', team: 'GUINNESS MERCEDES', country: 'FRANCE', flagUrl: 'https://cdn-icons-png.flaticon.com/128/197/197560.png', carImageUrl: 'https://media.formula1.com/image/upload/v1716474050/fom-website/2024/VIAPLAY/Mercedes%20W15/W15_Hamilton_V1_s.png.transform/4col-retina/image.png', baseCareerStats: {} },
            'formulaphantom': { name: 'FORMULA PHANTOM', team: 'RACING BULLS PEUGEOT SPORT', country: 'USA', flagUrl: 'https://cdn-icons-png.flaticon.com/128/197/197484.png', carImageUrl: 'https://media.formula1.com/image/upload/v1716474051/fom-website/2024/VIAPLAY/VCARB%2001/VCARB01_Ricciardo_V1_s.png.transform/4col-retina/image.png', baseCareerStats: {} },
            'rookie': { name: 'ROOKIE', team: 'HAAS ONLYFANS RACING', country: 'UNITED KINGDOM', flagUrl: 'https://cdn-icons-png.flaticon.com/128/197/197374.png', carImageUrl: 'https://media.formula1.com/image/upload/v1716474050/fom-website/2024/VIAPLAY/Haas%20VF-24/VF-24_Hulkenberg_V1_s.png.transform/4col-retina/image.png', baseCareerStats: {} },
            'machmudmoerwijk': { name: 'MACHMUD MOERWIJK', team: 'Placeholder Team', country: 'UNKNOWN', flagUrl: 'https://placehold.co/32x24/cccccc/000000?text=?', carImageUrl: 'https://placehold.co/600x400/cccccc/000000?text=Car', baseCareerStats: {} },
            'kevinjerling': { name: 'KEVIN JERLING', team: 'Placeholder Team', country: 'UNKNOWN', flagUrl: 'https://placehold.co/32x24/cccccc/000000?text=?', carImageUrl: 'https://placehold.co/600x400/cccccc/000000?text=Car', baseCareerStats: {} },
            'caiomhe': { name: 'CAIOMHE', team: 'Placeholder Team', country: 'UNKNOWN', flagUrl: 'https://placehold.co/32x24/cccccc/000000?text=?', carImageUrl: 'https://placehold.co/600x400/cccccc/000000?text=Car', baseCareerStats: {} },
            'phoenix': { name: 'PHOENIX', team: 'Placeholder Team', country: 'UNKNOWN', flagUrl: 'https://placehold.co/32x24/cccccc/000000?text=?', carImageUrl: 'https://placehold.co/600x400/cccccc/000000?text=Car', baseCareerStats: {} }
        };

        // --- UTILITY FUNCTIONS ---
        function getPoints(position) {
            const pos = String(position);
            const pointsMap = { '1': 25, '2': 20, '3': 16, '4': 13, '5': 11, '6': 10, '7': 9, '8': 8, '9': 7, '10': 6, '11': 5, '12': 4, '13': 3, '14': 2, '15': 1 };
            return pointsMap[pos] || 0;
        }

        function getResultString(time, pos) {
            const finalPos = String(pos).toUpperCase();
            if (['DNF', 'DNP', 'DSQ'].includes(finalPos)) return finalPos;
            return time || 'N/A';
        }

        function addOrUpdateRace(driver, newRace) {
            const existingRaceIndex = driver.recentRaces.findIndex(race => race.gp === newRace.gp);
            if (newRace.pos === 'DNP') {
                driver.recentRaces = driver.recentRaces.filter(race => race.gp !== newRace.gp);
            } else if (existingRaceIndex > -1) {
                driver.recentRaces[existingRaceIndex] = newRace;
            } else {
                driver.recentRaces.unshift(newRace);
            }
        }
        
        function createQualifyingMap(qualifyingResultsArray) {
            const qMap = {};
            if (!qualifyingResultsArray) return qMap;

            qualifyingResultsArray.forEach(qEntry => {
                const driverKey = getDriverKey(qEntry.driver);
                if (driverKey) {
                    qMap[driverKey] = String(qEntry.pos);
                }
            });
            return qMap;
        }

        function getDriverKey(driverName) {
            if (!driverName) return null;
            const driverNameKeyMap = {
                'yuki tsunoda': 'tonyseroka', 'loler_xd': 'loler', 'aspec': 'aspec33',
                'max housley': 'maxhousley', 'jay2005_071': 'jayazier', 'jstn nl': 'jstnnl',
                'teeetoe': 'teetoe', 'shark772': 'shark', 'sneeuwzz': 'sneeuw', 'theromaniandevil': 'theromaniandevil'
            };
            const cleanName = driverName.toLowerCase().replace(/[\s_]/g, '');
            return driverNameKeyMap[cleanName] || (driverData[cleanName] ? cleanName : null);
        }

        function processRaceData(gpName, flagUrl, resultsArray, qualifyingMap = {}) {
            if (!resultsArray) return;
            resultsArray.forEach(result => {
                const driverKey = getDriverKey(result.driver);
                if (!driverKey) {
                    console.warn(`Could not map or find driver key for '${result.driver}' in ${gpName}. Skipping.`);
                    return;
                }
                const driver = driverData[driverKey];
                if (!driver) {
                    console.warn(`Driver data for key '${driverKey}' (from '${result.driver}') not found. Skipping.`);
                    return;
                }

                const gridPosition = qualifyingMap[driverKey] || result.grid || 'N/A';
                const position = String(result.pos || 'N/A');
                const time = result.time || result.result; // Handle both time and result keys
                const resultStr = getResultString(time, position);

                const newRaceEntry = {
                    gp: gpName, flag: flagUrl, pos: position, grid: String(gridPosition),
                    stops: result.stops !== undefined ? String(result.stops) : 'N/A',
                    result: resultStr,
                    pts: String(getPoints(position))
                };
                addOrUpdateRace(driver, newRaceEntry);
            });
        }

        // --- PAGE LOAD LOGIC ---
        window.onload = function() {
            // 1. Initialize all drivers with tiers and empty data structures
            Object.keys(driverData).forEach(key => {
                if (tier1DriverKeys.includes(key)) driverData[key].tier = 1;
                else if (tier2DriverKeys.includes(key)) driverData[key].tier = 2;
                else driverData[key].tier = 1; // Default tier
                driverData[key].recentRaces = [];
                driverData[key].seasonStats = {};
                if (!driverData[key].baseCareerStats) driverData[key].baseCareerStats = {};
            });

            // 2. Define all raw race and qualifying data
            const bahrainQuali = [
                { pos: 1, driver: 'MAXFAN1982'}, { pos: 2, driver: 'ANTON CHEBOTAROV'}, { pos: 3, driver: 'FOCUSER' }, { pos: 4, driver: 'ALPHAROMEO127' }
            ];

            const bahrainRace = [
                // T1
                { pos: 1, driver: "ANTON CHEBOTAROV", team: "HOT WHEELS MCLAREN", stops: 2, time: "45:15:184" },
                { pos: 2, driver: "FOCUSER", team: "HOT WHEELS MCLAREN", stops: 2, time: "+10.026" },
                { pos: 3, driver: "YUKI TSUNODA", team: "NEWPORT ROLEX RED BULL RACING", stops: 2, time: "+22.388" },
                { pos: 4, driver: "MAXFAN1982", team: "NEWPORT ROLEX RED BULL RACING", stops: 2, time: "+24.353" },
                { pos: 5, driver: "ALPHAROMEO127", team: "SCUDERIA FERRARI", stops: 1, time: "+26.454" },
                { pos: 6, driver: "SEBEINKRO", team: "MERCEDES-AMG PETRONAS", stops: 2, time: "+28.709" },
                { pos: 7, driver: "ASPEC33", team: "TINDER ALPINE F1 TEAM", stops: 2, time: "+30.000" },
                { pos: 8, driver: "MORA", team: "RACING BULLS PEUGEOT SPORT", stops: 2, time: "+32.937" },
                { pos: 9, driver: "TSAR", team: "RACING BULLS PEUGEOT SPORT", stops: 1, time: "+40.504" },
                { pos: 10, driver: "BYRONAS", team: "GUINNESS MERCEDES", stops: 2, time: "+50.000" },
                { pos: 11, driver: "MAX AMMERLAAN", team: "RACING BULLS PEUGEOT SPORT", stops: 2, time: "+1:05.000" },
                { pos: 12, driver: "JSTN NL", team: "SCUDERIA FERRARI", stops: 2, time: "+1:10.000" },
                { pos: 13, driver: "SHENGEN", team: "MERCEDES-AMG PETRONAS", stops: 2, time: "+54.789" },
                { pos: 14, driver: "MAX HOUSLEY", team: "TINDER ALPINE F1 TEAM", stops: 2, time: "+1:00.196" },
                { pos: 15, driver: "LUCA STEVENS", team: "LOCKHEED MARTIN AM", stops: 2, time: "+1 LAP" },
                // T2
                { pos: 1, driver: "SANDRO", team: "HOT WHEELS MCLAREN", stops: 2, time: "Leader" },
                { pos: 2, driver: "JAY2005_071", team: "HOT WHEELS MCLAREN", stops: 2, time: "+5.000" },
                { pos: 3, driver: "MANUEL ROTUNDO", team: "SCUDERIA FERRARI", stops: 2, time: "+8.000" },
                { pos: 4, driver: "LUKAS", team: "HAAS ONLYFANS RACING", stops: 2, time: "+15.000" },
                { pos: 5, driver: "TUKI", team: "TINDER ALPINE F1 TEAM", stops: 2, time: "+18.000" },
                { pos: 6, driver: "TEEETOE", team: "NEWPORT ROLEX RED BULL RACING", stops: 2, time: "+20.000" },
                { pos: 8, driver: "JARVIS COID", team: "TWITCH SAUBER", stops: 2, time: "+35.000" },
                { pos: 9, driver: "SHARK772", team: "LOCKHEED MARTIN ASTON MARTIN", stops: 2, time: "+45.000" },
                { pos: 12, driver: "SPYZER", team: "TWITCH SAUBER", stops: 0, time: "DNF" },
                { pos: 13, driver: "SCORENZY", team: "GUINNESS MERCEDES", stops: 0, time: "DNF" },
                { pos: 14, driver: "FORMULA PHANTOM", team: "RACING BULLS PEUGEOT SPORT", stops: 0, time: "DSQ" }
            ];

            const australiaQuali = [
                { pos: 1, driver: "MAXFAN1982" }, { pos: 2, driver: "FOCUSER" }, { pos: 3, driver: "YUKI TSUNODA" },
                { pos: 4, driver: "ANTON CHEBOTAROV" }, { pos: 5, driver: "ALPHAROMEO127" }, { pos: 6, driver: "MORA" },
                { pos: 7, driver: "SEBEINKRO" }, { pos: 8, driver: "MAXLINXC" }, { pos: 9, driver: "ANTONIO BRANCATI" },
                { pos: 10, driver: "MAX HOUSLEY" }, { pos: 11, driver: "STRA" }, { pos: 12, driver: "TSAR" },
                { pos: 13, driver: "COUNTERFEIT" }, { pos: 14, driver: "THEROMANIANDEVIL" }, { pos: 15, driver: "YULIAN KALENANTOVICH" },
                { pos: 16, driver: "LUCA STEVENS" }, { pos: 17, driver: "NOJUS GEDVILAS" }, { pos: 18, driver: "LOLER_XD" },
                { pos: 19, driver: "RABAS" }, { pos: 20, driver: "EDGE" },
                { pos: 1, driver: "SANDRO" }, { pos: 2, driver: "JSTN NL" }, { pos: 3, driver: "MANUEL ROTUNDO" },
                { pos: 4, driver: "JAY2005_071" }, { pos: 5, driver: "JARVIS COID" }, { pos: 6, driver: "TEEETOE" },
                { pos: 8, driver: "MARK" }, { pos: 9, driver: "SHARK772" }, { pos: 10, driver: "BYRONAS" },
                { pos: 11, driver: "ROOKIE" }, { pos: 12, driver: "SNEEUWZZ" }, { pos: 13, driver: "DANIELS" }
            ];

            const australiaRace = [
                 // T1
                { pos: 1, driver: "MAXFAN1982", stops: 2, time: "46:34.539" }, { pos: 2, driver: "FOCUSER", stops: 2, time: "+3.552" },
                { pos: 3, driver: "MAX HOUSLEY", stops: 3, time: "+4.530" }, { pos: 4, driver: "SEBEINKRO", stops: 2, time: "+6.868" },
                { pos: 5, driver: "MORA", stops: 2, time: "+7.528" }, { pos: 6, driver: "LUCA STEVENS", stops: 2, time: "+10.799" },
                { pos: 7, driver: "COUNTERFEIT", stops: 3, time: "+12.213" }, { pos: 8, driver: "TSAR", stops: 3, time: "+12.665" },
                { pos: 9, driver: "ANTONIO BRANCATI", stops: 2, time: "+14.116" }, { pos: 10, driver: "NOJUS GEDVILAS", stops: 2, time: "+22.685" },
                { pos: 11, driver: "ANTON CHEBOTAROV", stops: 2, time: "+25.075" }, { pos: 12, driver: "EDGE", stops: 2, time: "+26.424" },
                { pos: 13, driver: "RABAS", stops: 3, time: "+29.581" }, { pos: 14, driver: "YUKI TSUNODA", stops: 3, time: "+33.076" },
                { pos: 15, driver: "MAXLINXC", stops: 3, time: "+3 LAPS" }, { pos: 16, driver: "YULIAN KALENANTOVICH", stops: 0, time: "DNF" },
                { pos: 17, driver: "STRA", stops: 1, time: "DNF" }, { pos: 18, driver: "THEROMANIANDEVIL", stops: 1, time: "DNF" },
                { pos: 19, driver: "LOLER_XD", stops: 0, time: "DNF" }, { pos: 20, driver: "ALPHAROMEO127", stops: 0, time: "DNF" },
                // T2
                { pos: 1, driver: "JAY2005_071", stops: 2, time: "Leader" }, { pos: 2, driver: "SANDRO", stops: 2, time: "+1.218" },
                { pos: 3, driver: "MAXLINXC", stops: 2, time: "+1.854" }, { pos: 4, driver: "JSTN NL", stops: 2, time: "+3.136" },
                { pos: 5, driver: "JARVIS COID", stops: 2, time: "+3.297" }, { pos: 6, driver: "MANUEL ROTUNDO", stops: 2, time: "+5.496" },
                { pos: 7, driver: "BYRONAS", stops: 2, time: "+16.149" }, { pos: 8, driver: "MARK", stops: 2, time: "+20.872" },
                { pos: 9, driver: "DANIELS", stops: 2, time: "+59.070" }, { pos: 10, driver: "TEEETOE", stops: 2, time: "+1:15.379" },
                { pos: 11, driver: "SNEEUWZZ", stops: 1, time: "DNF" }, { pos: 12, driver: "ROOKIE", stops: 1, time: "DNF" },
                { pos: 13, driver: "SHARK772", stops: 1, time: "DNF" }
            ];

            // 3. Process the data
            const bahrainQualiMap = createQualifyingMap(bahrainQuali);
            const australiaQualiMap = createQualifyingMap(australiaQuali);

            processRaceData('Bahrain Grand Prix', 'https://cdn-icons-png.flaticon.com/128/197/197521.png', bahrainRace, bahrainQualiMap);
            processRaceData('Australian Grand Prix', 'https://cdn-icons-png.flaticon.com/128/197/197507.png', australiaRace, australiaQualiMap);
            
            // 4. Calculate stats and load page
            calculateAllSeasonStats();
            
            const urlParams = new URLSearchParams(window.location.search);
            const driverKeyParam = (urlParams.get('driver') || 'focuser').replace(/[\s_]/g, '').toLowerCase();
            const foundKey = Object.keys(driverData).find(k => k.toLowerCase() === driverKeyParam) || 'focuser';
            
            loadDriverData(foundKey);
            setupMenu();
            setupSubHeader();
        };
        
        // --- DATA CALCULATION & DISPLAY FUNCTIONS ---
        function calculateAllSeasonStats() {
            const standings = { 1: [], 2: [] };
            Object.keys(driverData).forEach(key => {
                const driver = driverData[key];
                let sPoints = 0, sWins = 0, sPodiums = 0, sPoles = 0, sDNFs = 0, sTop10s = 0;
                driver.recentRaces.forEach(race => {
                    sPoints += getPoints(race.pos);
                    if (race.pos === '1') sWins++;
                    if (['1', '2', '3'].includes(race.pos)) sPodiums++;
                    if (race.grid === '1') sPoles++; 
                    if (['DNF', 'DSQ'].includes(race.pos)) sDNFs++;
                    const posNum = parseInt(race.pos, 10);
                    if (!isNaN(posNum) && posNum <= 10) sTop10s++;
                });
                driver.seasonStats = {
                    'Grand Prix Points': sPoints, 'Grand Prix Races': driver.recentRaces.length, 'Wins': sWins,
                    'Podiums': sPodiums, 'Pole Positions': sPoles, 'DNFs': sDNFs, 'Grand Prix Top 10s': sTop10s
                };
                if (standings[driver.tier]) {
                    standings[driver.tier].push({ key: key, points: sPoints });
                }
            });
            
            Object.keys(standings).forEach(tier => {
                standings[tier].sort((a, b) => b.points - a.points);
                standings[tier].forEach((d, index) => {
                    const pos = index + 1;
                    let suffix = 'th';
                    if (pos % 10 === 1 && pos % 100 !== 11) suffix = 'st';
                    else if (pos % 10 === 2 && pos % 100 !== 12) suffix = 'nd';
                    else if (pos % 10 === 3 && pos % 100 !== 13) suffix = 'rd';
                    driverData[d.key].seasonStats['Season Position'] = `TIER ${tier}: ${pos}${suffix}`;
                });
            });
        }

        function loadDriverData(driverKey) {
            const driver = driverData[driverKey];
            if (!driver) { console.error("Driver not found:", driverKey); return; }

            const base = driver.baseCareerStats;
            const season = driver.seasonStats;
            const get = (stat, source = base) => parseInt(source[stat] || 0, 10);

            const career = {
                'Grand Prix Entered': get('Grand Prix Entered') + get('Grand Prix Races', season),
                'Wins': get('Wins') + get('Wins', season),
                'Podiums': get('Podiums') + get('Podiums', season),
                'Career Points': get('Career Points') + get('Grand Prix Points', season),
                'Pole Positions': get('Pole Positions') + get('Pole Positions', season),
                'DNFs': get('DNFs') + get('DNFs', season),
                'World Championships': base['World Championships'] !== undefined ? base['World Championships'] : 'N/A'
            };
            const totalRaces = career['Grand Prix Entered'];
            career['Win Percentage'] = totalRaces > 0 ? ((career['Wins'] / totalRaces) * 100).toFixed(1) + '%' : '0.0%';
            career['Podium Percentage'] = totalRaces > 0 ? ((career['Podiums'] / totalRaces) * 100).toFixed(1) + '%' : '0.0%';

            let bestPos = Infinity;
            driver.recentRaces.forEach(r => { const p = parseInt(r.pos); if (!isNaN(p)) bestPos = Math.min(bestPos, p); });
            if (bestPos !== Infinity) {
                let suffix = 'th';
                if (bestPos === 1) suffix = 'st'; else if (bestPos === 2) suffix = 'nd'; else if (bestPos === 3) suffix = 'rd';
                career['Highest Race Finish'] = `${bestPos}${suffix}`;
            } else {
                career['Highest Race Finish'] = 'N/A';
            }
            
            // --- Update DOM ---
            document.getElementById('driver-banner').style.backgroundColor = teamColors[driver.team] || '#333';
            document.getElementById('driver-name').textContent = driver.name;
            document.getElementById('driver-flag').src = driver.flagUrl;
            document.getElementById('driver-country').textContent = driver.country;
            document.getElementById('driver-team').textContent = driver.team;
            document.getElementById('team-icon').src = teamIcons[driver.team] || '';
            document.getElementById('driver-car-img').src = driver.carImageUrl;
            document.getElementById('driver-car-img').alt = driver.team + ' Car';

            const populateGrid = (gridId, stats, order) => {
                const grid = document.getElementById(gridId);
                grid.innerHTML = '';
                order.forEach(label => {
                    if (stats[label] !== undefined && stats[label] !== null) {
                        grid.innerHTML += `<div class="flex flex-col"><span class="text-lg font-semibold text-white">${stats[label]}</span><span class="text-sm">${label}</span></div>`;
                    }
                });
            };
            populateGrid('season-stats-grid', season, ['Season Position', 'Grand Prix Points', 'Grand Prix Races', 'Wins', 'Podiums', 'Pole Positions', 'Grand Prix Top 10s', 'DNFs']);
            populateGrid('career-stats-grid', career, ['Grand Prix Entered', 'Wins', 'Podiums', 'Career Points', 'Pole Positions', 'DNFs', 'World Championships', 'Highest Race Finish', 'Win Percentage', 'Podium Percentage']);

            const racesTbody = document.getElementById('recent-races-tbody');
            racesTbody.innerHTML = '';
            if (driver.recentRaces && driver.recentRaces.length > 0) {
                const sortedRaces = [...driver.recentRaces].sort((a,b) => b.gp.localeCompare(a.gp)); // Simple sort for now
                sortedRaces.forEach((race, index) => {
                    const borderClass = index < sortedRaces.length - 1 ? 'border-b border-gray-600' : '';
                    racesTbody.innerHTML += `<tr class="${borderClass}"><td class="px-6 py-4 whitespace-nowrap uppercase"><div class="flex items-center"><img src="${race.flag}" alt="${race.gp} Flag" class="h-4 w-auto mr-3 rounded-sm"><span>${race.gp}</span></div></td><td class="px-6 py-4 whitespace-nowrap uppercase">${race.pos}</td><td class="px-6 py-4 whitespace-nowrap uppercase">${race.grid}</td><td class="px-6 py-4 whitespace-nowrap uppercase">${race.stops}</td><td class="px-6 py-4 whitespace-nowrap uppercase">${race.result}</td><td class="px-6 py-4 whitespace-nowrap font-bold uppercase">${race.pts}</td></tr>`;
                });
            } else {
                racesTbody.innerHTML = `<tr><td colspan="6" class="text-center py-4 uppercase">No recent race data available.</td></tr>`;
            }
        }

        // --- UI SETUP FUNCTIONS ---
        function setupMenu() {
            const mobileMenuButton = document.getElementById('mobile-menu-button');
            const mobileMenu = document.getElementById('mobile-menu');
            mobileMenuButton.addEventListener('click', () => {
                mobileMenu.classList.toggle('menu-open');
                mobileMenuButton.classList.toggle('open');
            });
            const menuItemsContainer = document.getElementById('desktop-menu-items');
            if (!menuItemsContainer) return;
            const menuLinks = menuItemsContainer.querySelectorAll('a');
            const highlighter = document.getElementById('sliding-highlighter');
            const activeLink = menuItemsContainer.querySelector('a[href*="standings.html"]'); // Highlight standings link
            function setHighlighterToLink(link) {
                if (!link || !highlighter) return;
                highlighter.style.left = `${link.offsetLeft}px`;
                highlighter.style.width = `${link.offsetWidth}px`;
            }
            if (activeLink) activeLink.style.color = 'white';
            setHighlighterToLink(activeLink);
            menuLinks.forEach(link => {
                link.addEventListener('mouseenter', () => setHighlighterToLink(link));
                link.addEventListener('focus', () => setHighlighterToLink(link));
            });
            menuItemsContainer.addEventListener('mouseleave', () => setHighlighterToLink(activeLink));
            menuItemsContainer.addEventListener('focusout', () => setHighlighterToLink(activeLink));
        }

        function setupSubHeader() {
            const upcomingRaceInfoEl = document.getElementById('upcoming-race-info');
            const upcomingRaceDateEl = document.getElementById('upcoming-race-date');
            const countdownTimerEl = document.getElementById('countdown-timer');
            if (!upcomingRaceInfoEl || !upcomingRaceDateEl || !countdownTimerEl) return;
            upcomingRaceInfoEl.textContent = 'UPCOMING: EMILIA ROMAGNA GRAND PRIX';
            upcomingRaceDateEl.textContent = 'JUNE 27TH';
            
            function getNextFriday2PMET() {
                const now = new Date();
                let target = new Date(Date.UTC(2025, 5, 27, 18, 0, 0)); // June 27, 2025, 2 PM EDT = 18:00 UTC
                if (now > target) {
                    // This logic would need to be updated for future races
                    return target; // Return past date if event has passed
                }
                return target;
            }
            
            let countdownTargetDate = getNextFriday2PMET();

            function updateCountdown() {
                const now = new Date();
                const difference = countdownTargetDate.getTime() - now.getTime();
                if (difference <= 0) {
                    countdownTimerEl.textContent = "EVENT HAS CONCLUDED";
                    return;
                }
                const days = Math.floor(difference / (1000 * 60 * 60 * 24));
                const hours = Math.floor((difference % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((difference % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((difference % (1000 * 60)) / 1000);
                countdownTimerEl.textContent = `COUNTDOWN: ${days}D ${String(hours).padStart(2, '0')}H ${String(minutes).padStart(2, '0')}M ${String(seconds).padStart(2, '0')}S`;
            }
            updateCountdown();
            setInterval(updateCountdown, 1000);
        }
    </script>
</body>
</html>
